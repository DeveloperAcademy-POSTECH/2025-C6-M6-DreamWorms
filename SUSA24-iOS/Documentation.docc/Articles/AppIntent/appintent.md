# App Intent ê¸°ë°˜ ìœ„ì¹˜ ë°ì´í„° ìë™ ìˆ˜ì§‘ (App Intent Feature)
í†µì‹ ì‚¬ ê¸°ì§€êµ­ ë¬¸ìë¥¼ iOS ë‹¨ì¶•ì–´ë¡œ ìˆ˜ì‹ í•˜ì—¬, ì£¼ì†Œ ì¶”ì¶œ â†’ ì¢Œí‘œ ë³€í™˜ â†’ CoreData ì €ì¥ â†’ íƒ€ì„ë¼ì¸/ì§€ë„ ì‹¤ì‹œê°„ ë°˜ì˜ê¹Œì§€ì˜ **End-to-End ìœ„ì¹˜ ë°ì´í„° ìë™í™” íŒŒì´í”„ë¼ì¸**ì…ë‹ˆë‹¤.

> ğŸ“… **ì‘ì„±ì¼**: 2026.02.10
> ğŸ‘¤ **ì‘ì„±ì**: ìœ ê²½ëª¨ (Gyeongmo)
> ğŸ·ï¸ **ë²„ì „**: v1.0

## 1. ê¸°ëŠ¥ ê°œìš”

### ê¸°ëŠ¥ëª…

- **App Intent ê¸°ë°˜ ë©”ì„¸ì§€ ìœ„ì¹˜ ë°ì´í„° ìë™ ì¶”ì¶œ ë° ì‚¬ê±´ íƒ€ì„ë¼ì¸/ì§€ë„ ë°˜ì˜**

### ê¸°ëŠ¥ ì •ì˜

ë³¸ ê¸°ëŠ¥ì€ í†µì‹ ì‚¬ë¡œë¶€í„° ìˆ˜ì‹ ë˜ëŠ” ê¸°ì§€êµ­ ìœ„ì¹˜ ë¬¸ìë¥¼ **iOS ë‹¨ì¶•ì–´ ìë™í™”**ë¥¼ í†µí•´ ``ReceiveMessageIntent``ê°€ ìˆ˜ì‹ í•˜ê³ ,
``MessageParser``ë¡œ í…ìŠ¤íŠ¸ ë‚´ ì£¼ì†Œë¥¼ ì¶”ì¶œí•œ ë’¤ ``NaverGeocodeAPIService``ë¥¼ í†µí•´ ìœ„ê²½ë„ ì¢Œí‘œë¡œ ë³€í™˜í•˜ì—¬
``LocationRepository``ì— ì €ì¥í•˜ëŠ” ìë™í™” íŒŒì´í”„ë¼ì¸ì…ë‹ˆë‹¤.

ì €ì¥ëœ ìœ„ì¹˜ ë°ì´í„°ëŠ” ``MainTabFeature``ì˜ **SSOT(Single Source of Truth) Observer íŒ¨í„´**ì„ í†µí•´ ì‹¤ì‹œê°„ìœ¼ë¡œ ê°ì§€ë˜ë©°,
``TimeLineFeature``ì™€ ``MapFeature``ì— ìë™ ì „íŒŒë˜ì–´ íƒ€ì„ë¼ì¸ ë°”í…€ì‹œíŠ¸ì™€ ì§€ë„ì— ì¦‰ì‹œ ë°˜ì˜ë©ë‹ˆë‹¤.

### ë„ì… ëª©ì 

- **ìˆ˜ë™ ì…ë ¥ ì œê±°**: ìˆ˜ì‚¬ ê³¼ì •ì—ì„œ ë°˜ë³µë˜ëŠ” "ë¬¸ì í™•ì¸ â†’ íƒ€ ì§€ë„ì•± ìˆ˜ë™ ì…ë ¥ â†’ ìœ„ì¹˜ í™•ì¸ â†’ íŒ€ ê³µìœ " ë‹¨ê³„ë¥¼ ìë™í™”í•˜ì—¬ ì…ë ¥ ì˜¤íƒ€, ëˆ„ë½, ì‹œê°„ ì§€ì—°ì„ ìµœì†Œí™”í•©ë‹ˆë‹¤.
- **ì‚¬ê±´ë³„ ë°ì´í„° ì¶•ì **: ìœ„ì¹˜ ì •ë³´ë¥¼ ì‚¬ê±´ ë‹¨ìœ„ë¡œ ìë™ ë¶„ë¥˜/ì €ì¥í•˜ì—¬ íƒ€ì„ë¼ì¸ ê¸°ë°˜ ì¶”ì  íš¨ìœ¨ì„ í–¥ìƒì‹œí‚µë‹ˆë‹¤.
- **ì‹¤ì‹œê°„ ê°€ì‹œí™”**: ìˆ˜ì§‘ ì¦‰ì‹œ ì§€ë„ í•€ + íƒ€ì„ë¼ì¸ ì…€ë¡œ í‘œì¤€í™”ëœ í˜•íƒœë¡œ ì œê³µí•˜ì—¬ í•œ ëˆˆì— íŒŒì•… ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤.

---

## 2. ê¸°ëŠ¥ ì ìš© ë²”ìœ„

### ì‚¬ìš© ìœ„ì¹˜

ë³¸ ê¸°ëŠ¥ì€ **ì•± ì™¸ë¶€(iOS ë‹¨ì¶•ì–´)** ì—ì„œ íŠ¸ë¦¬ê±°ë˜ì–´ **ì•± ë‚´ë¶€(CoreData â†’ UI)** ê¹Œì§€ ê´€í†µí•˜ëŠ” End-to-End íŒŒì´í”„ë¼ì¸ì…ë‹ˆë‹¤.

1. **iOS ë‹¨ì¶•ì–´ ì•±**: ìë™í™” ê·œì¹™ ì„¤ì • í›„, ë¬¸ì ìˆ˜ì‹  ì‹œ ``ReceiveMessageIntent`` ìë™ ì‹¤í–‰
2. **MainTabScene**: SSOT Observerê°€ CoreData ë³€ê²½ì„ ê°ì§€í•˜ì—¬ í•˜ìœ„ Featureì— ì „íŒŒ
3. **TimeLineScene**: ìƒˆ ìœ„ì¹˜ Cellì´ íƒ€ì„ë¼ì¸ ë°”í…€ì‹œíŠ¸ì— ìë™ ì¶”ê°€
4. **MapScene**: ìƒˆ ìœ„ì¹˜ í•€ì´ ì§€ë„ì— ìë™ í‘œì‹œ

### ì‚¬ìš©ì ê´€ì  ë™ì‘ ì¡°ê±´

1. **ì‚¬ì „ ì¡°ê±´**
    - ì‚¬ìš©ìê°€ iOS ë‹¨ì¶•ì–´ ì•±ì—ì„œ ìë™í™” ê·œì¹™ì„ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.
    - ìë™í™” ì¡°ê±´: 'ë©”ì‹œì§€ ìˆ˜ì‹  ì‹œ' ë©”ì‹œì§€ í¬í•¨ ë‚´ìš© `[ë°œì‹ ê¸°ì§€êµ­]`ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
    - ìë™í™” ë™ì‘: 'ìˆ˜ì‚¬24' ì•±ì˜ 'ê¸°ì§€êµ­ ìœ„ì¹˜ì •ë³´ ì €ì¥í•˜ê¸°'(``ReceiveMessageIntent``)ë¥¼ ì‹¤í–‰ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
    - ì‚¬ê±´ì— í”¼ì˜ìë¥¼ ì¶”ì í•  ê¸°ì§€êµ­ ì „í™”ë²ˆí˜¸ê°€ ì •í™•íˆ ë“±ë¡ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.

2. **íŠ¸ë¦¬ê±° ì¡°ê±´**
    - í†µì‹ ì‚¬ë¡œë¶€í„° ê¸°ì§€êµ­ ìœ„ì¹˜ ë¬¸ìê°€ ìˆ˜ì‹ ë©ë‹ˆë‹¤.
    - ë¬¸ì ë‚´ìš©ì— `[ë°œì‹ ê¸°ì§€êµ­]` í‚¤ì›Œë“œê°€ í¬í•¨ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
    - "í™•ì¸ë¶ˆê°€", "ì „ì›êº¼ì§" ë“± ë¬´íš¨ í‚¤ì›Œë“œê°€ ìˆìœ¼ë©´ ``MessageParser``ê°€ `nil`ì„ ë°˜í™˜í•˜ì—¬ ì €ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

3. **ì²˜ë¦¬ ì¡°ê±´**
    - ê¸°ì§€êµ­ ë°œì‹  ì „í™”ë²ˆí˜¸ê°€ ë“±ë¡ëœ ì‚¬ê±´ì˜ í”¼ì˜ì ë²ˆí˜¸ì™€ ì¼ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤.
    - Naver Geocoding API í˜¸ì¶œì´ ê°€ëŠ¥í•´ì•¼ í•©ë‹ˆë‹¤. (ë„¤íŠ¸ì›Œí¬ ì—°ê²° í•„ìˆ˜)
    - CoreData ì €ì¥ ê³µê°„ì´ í™•ë³´ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.

4. **ê²°ê³¼ ì¡°ê±´**
    - ì €ì¥ ì™„ë£Œ ì‹œ: ì‹œìŠ¤í…œ ì•Œë¦¼ "ìœ„ì¹˜ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤: (ì£¼ì†Œ)" í‘œì‹œ
    - ì•± ì§„ì… ì‹œ: íƒ€ì„ë¼ì¸ ë°”í…€ì‹œíŠ¸ì— ìƒˆ ìœ„ì¹˜ Cellì´ ìë™ ì—…ë°ì´íŠ¸
    - ì§€ë„ì— ìƒˆ í•€ì´ ìë™ í‘œì‹œ (ìƒˆë¡œê³ ì¹¨ ë¶ˆí•„ìš”)

---

## 3. í™”ë©´ íë¦„ë„ (Screen Flow)

> SMS ìˆ˜ì‹ ë¶€í„° ì•± ë‚´ ë°ì´í„° ë°˜ì˜ê¹Œì§€ì˜ ì „ì²´ íë¦„

![App Intent í™”ë©´ íë¦„ë„](appintent-screen-flow.svg)

---

## 4. ê¸°ëŠ¥ ì „ì²´ íë¦„

### 4.1 ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨

![App Intent ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨](appintent-sequence-diagram.svg)

### 4.2 ë°ì´í„° ë³€í™˜ íë¦„ (Data Transformation Pipeline)

SMS ì›ë³¸ í…ìŠ¤íŠ¸ê°€ ìµœì¢… UI ì»´í¬ë„ŒíŠ¸ë¡œ ë³€í™˜ë˜ê¸°ê¹Œì§€ **7ë‹¨ê³„ ë³€í™˜**ì„ ê±°ì¹©ë‹ˆë‹¤.

![App Intent ë°ì´í„° ë³€í™˜ ë‹¤ì´ì–´ê·¸ë¨](appintent-data-transform-diagram.svg)

### 4.3 íë¦„ ì„¤ëª…

1) **SMS ìˆ˜ì‹  â†’ App Intent ì§„ì…**
    - í†µì‹ ì‚¬ ê¸°ì§€êµ­ ë¬¸ìê°€ ìˆ˜ì‹ ë˜ë©´ iOS ë‹¨ì¶•ì–´ê°€ `[ë°œì‹ ê¸°ì§€êµ­]` íŒ¨í„´ì„ ê°ì§€í•˜ì—¬ ``ReceiveMessageIntent``ì˜ `perform()` ë©”ì„œë“œë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
    - IntentëŠ” ë¬¸ì ë°œì‹  ë²ˆí˜¸ë¥¼ **ì •ê·œí™”**(í•˜ì´í”ˆ ì œê±°, `+82` â†’ `0` ë³€í™˜)í•©ë‹ˆë‹¤.

2) **ì‚¬ê±´ ë§¤ì¹­**
    - ``CaseRepository``ì˜ `findCaseTest(byCasePhoneNumber:)`ë¥¼ í˜¸ì¶œí•˜ì—¬, ì •ê·œí™”ëœ ë²ˆí˜¸ë¡œ ë“±ë¡ëœ ì‚¬ê±´ì„ ì¡°íšŒí•©ë‹ˆë‹¤.
    - ë§¤ì¹­ë˜ëŠ” ì‚¬ê±´ì´ ì—†ìœ¼ë©´ "í•´ë‹¹ ì „í™”ë²ˆí˜¸ì˜ ì‚¬ê±´ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤" ë‹¤ì´ì–¼ë¡œê·¸ë¥¼ ë°˜í™˜í•˜ê³  ì¢…ë£Œí•©ë‹ˆë‹¤.

3) **ì£¼ì†Œ ì¶”ì¶œ**
    - ``MessageParser``ì˜ `extractAddress(from:)` ë©”ì„œë“œê°€ SMS ë³¸ë¬¸ì—ì„œ `[ë°œì‹ ê¸°ì§€êµ­]` ë§ˆì»¤ ì´í›„ì˜ í•œê¸€ ì£¼ì†Œë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤.
    - `containsInvalidKeywords()` ì²´í¬ë¥¼ í†µí•´ "í™•ì¸ë¶ˆê°€", "ì „ì› ìƒíƒœ N" ë“± ë¬´íš¨ ë¬¸ìë¥¼ í•„í„°ë§í•©ë‹ˆë‹¤.
    - ì¶”ì¶œëœ ì£¼ì†Œ ë’¤ì— ë‹¤ìŒ ì¤„ì˜ ê±´ë¬¼ ë²ˆí˜¸(ìˆ«ì)ë¥¼ ì—°ê²°í•©ë‹ˆë‹¤. (ì˜ˆ: "ë¶€ì‚°ê°•ì„œêµ¬ì§€ì‚¬ë™ 1299")

4) **ì¢Œí‘œ ë³€í™˜ (Geocoding)**
    - ``NaverGeocodeAPIService``ì˜ `geocode(address:)` ë©”ì„œë“œë¡œ ì¶”ì¶œëœ ì£¼ì†Œë¥¼ ìœ„ê²½ë„ ì¢Œí‘œë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
    - Naver Maps API í˜¸ì¶œ ì‹œ 10ì´ˆ íƒ€ì„ì•„ì›ƒì´ ì ìš©ë©ë‹ˆë‹¤.

5) **CoreData ì €ì¥**
    - ``LocationRepository``ì˜ `createLocationFromMessage(caseID:address:latitude:longitude:)` ë©”ì„œë“œë¡œ LocationEntityë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
    - ë‚´ë¶€ì ìœ¼ë¡œ `makeBoundingBox()`ë¥¼ í˜¸ì¶œí•˜ì—¬ 500m ë°˜ê²½ì˜ ë°”ìš´ë”© ë°•ìŠ¤ë¥¼ ìë™ ê³„ì‚°í•©ë‹ˆë‹¤.
    - `locationType: 2` (ê¸°ì§€êµ­ íƒ€ì…)ìœ¼ë¡œ ì €ì¥ë˜ë©°, `receivedAt`ì— í˜„ì¬ ì‹œê°ì´ ê¸°ë¡ë©ë‹ˆë‹¤.

6) **ì‹¤ì‹œê°„ ë™ê¸°í™” (SSOT Pattern)**
    - CoreData ì €ì¥ ì‹œ `NSManagedObjectContextObjectsDidChange` ì•Œë¦¼ì´ ë°œìƒí•©ë‹ˆë‹¤.
    - ``MainTabFeature``ì˜ `watchLocations()` AsyncStreamì´ ì´ë¥¼ ê°ì§€í•˜ì—¬ `state.locations`ë¥¼ ê°±ì‹ í•©ë‹ˆë‹¤.
    - ``MainTabView``ì˜ `.onChange(of: store.state.locations)`ê°€ íŠ¸ë¦¬ê±°ë˜ì–´:
        - ``TimeLineFeature``ì— `.updateData(caseInfo:locations:)` ì•¡ì…˜ ì „ì†¡
        - ``MapFeature``ì— locations ì „íŒŒ

> Tip:
> ì´ SSOT íŒ¨í„´ì˜ í•µì‹¬ì€ **ë°ì´í„° ì†Œìœ ê¶Œì˜ ë‹¨ì¼í™”**ì…ë‹ˆë‹¤.
> ìœ„ì¹˜ ë°ì´í„°ëŠ” ì˜¤ì§ ``MainTabFeature``ë§Œ ì†Œìœ (fetch/observe)í•˜ê³ ,
> ``TimeLineFeature``ì™€ ``MapFeature``ëŠ” ì „ë‹¬ë°›ì€ ë°ì´í„°ë¥¼ ì†Œë¹„(consume)í•˜ê¸°ë§Œ í•©ë‹ˆë‹¤.
> ì´ë¥¼ í†µí•´ ë°ì´í„° ë¶ˆì¼ì¹˜(Race Condition)ë¥¼ êµ¬ì¡°ì ìœ¼ë¡œ ë°©ì§€í•©ë‹ˆë‹¤.

---

## 5. ìƒíƒœ ë‹¤ì´ì–´ê·¸ë¨ (State Diagram)

### 5.1 ìƒíƒœ ë³€ìˆ˜ ì •ì˜ (State Variables)

App Intent FeatureëŠ” ìì²´ Stateê°€ ì•„ë‹Œ, ``MainTabFeature``ë¥¼ SSOTë¡œ í™œìš©í•©ë‹ˆë‹¤.

**MainTabFeature.State** (ìœ„ì¹˜ ë°ì´í„° SSOT)

| Variable Name | Description |
| :--- | :--- |
| ``MainTabFeature/State/selectedCurrentCaseId`` | í˜„ì¬ ì„ íƒëœ ì‚¬ê±´ ID |
| ``MainTabFeature/State/caseInfo`` | ë¡œë“œëœ ì‚¬ê±´ ìƒì„¸ ì •ë³´ |
| ``MainTabFeature/State/locations`` | í˜„ì¬ ì‚¬ê±´ì˜ ìœ„ì¹˜ ë°ì´í„° ë°°ì—´ (SSOT) |
| ``MainTabFeature/State/selectedTab`` | í˜„ì¬ ì„ íƒëœ íƒ­ (.map / .tracking / .dashboard) |

**ReceiveMessageIntent ë‚´ë¶€ ì²˜ë¦¬ ìƒíƒœ** (State ê°ì²´ ì—†ìŒ - ì ˆì°¨ì  ì²˜ë¦¬)

| ë‹¨ê³„ | ì„¤ëª… | ì‹¤íŒ¨ ì‹œ |
| :--- | :--- | :--- |
| ì „í™”ë²ˆí˜¸ ì •ê·œí™” | `+82` â†’ `0`, í•˜ì´í”ˆ/ê³µë°± ì œê±° | N/A (í•­ìƒ ì„±ê³µ) |
| ì‚¬ê±´ ì¡°íšŒ | `findCaseTest(byCasePhoneNumber:)` | "í•´ë‹¹ ì „í™”ë²ˆí˜¸ì˜ ì‚¬ê±´ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤" ë°˜í™˜ |
| ì£¼ì†Œ ì¶”ì¶œ | `extractAddress(from:)` | "ì£¼ì†Œë¥¼ ì¶”ì¶œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤" ë°˜í™˜ |
| ì¢Œí‘œ ë³€í™˜ | `geocode(address:)` | "ìœ„ì¹˜ ë³€í™˜ ì‹¤íŒ¨" ë°˜í™˜ |
| CoreData ì €ì¥ | `createLocationFromMessage()` | throws ì „íŒŒ |

### 5.2 ìƒíƒœ ë‹¤ì´ì–´ê·¸ë¨ (Visual Diagram)

![App Intent ìƒíƒœ ë‹¤ì´ì–´ê·¸ë¨](appintent-state-diagram.svg)

### 5.3 ì£¼ìš” ì „ì´ ìƒì„¸ (Transition Details)

- **SMS ìˆ˜ì‹  â†’ Intent ì‹¤í–‰**: iOS ë‹¨ì¶•ì–´ ìë™í™” íŠ¸ë¦¬ê±° â†’ `perform()` í˜¸ì¶œ
- **ì „í™”ë²ˆí˜¸ ì •ê·œí™” â†’ ì‚¬ê±´ ì¡°íšŒ**: ì •ê·œí™” ì™„ë£Œ í›„ ì¦‰ì‹œ `findCaseTest()` í˜¸ì¶œ
- **ì£¼ì†Œ ì¶”ì¶œ â†’ ì¢Œí‘œ ë³€í™˜**: `MessageParser` ê²°ê³¼ê°€ nilì´ ì•„ë‹Œ ê²½ìš°ì—ë§Œ ì§„í–‰
- **CoreData ì €ì¥ â†’ SSOT ê°±ì‹ **: `NSManagedObjectContextDidChange` â†’ `watchLocations()` AsyncStream ê°ì§€
- **SSOT ê°±ì‹  â†’ í•˜ìœ„ Feature ë™ê¸°í™”**: `MainTabView.onChange(of: locations)` â†’ `.updateData()` ì „ì†¡

---

## 6. ì˜ì¡´ì„± ë‹¤ì´ì–´ê·¸ë¨ (Dependency Diagram)

![App Intent ì˜ì¡´ì„± ë‹¤ì´ì–´ê·¸ë¨](appintent-dependency-diagram.svg)

---

## 7. íŒŒì¼ êµ¬ì¡°

```
Sources/
â”œâ”€â”€ ğŸ“ Data/
â”‚    â”œâ”€â”€ ğŸ—‚ï¸ Repository/
â”‚    â”‚    â”œâ”€â”€ CaseRepository.swift             // findCaseTest(byCasePhoneNumber:) - ì „í™”ë²ˆí˜¸ë¡œ ì‚¬ê±´ ì¡°íšŒ
â”‚    â”‚    â””â”€â”€ LocationRepository.swift         // createLocationFromMessage() - ë¬¸ì ê¸°ë°˜ ìœ„ì¹˜ ìƒì„±
â”‚    â”‚                                         // watchLocations() - CoreData ì‹¤ì‹œê°„ ë³€ê²½ ê°ì§€ AsyncStream
â”‚    â”œâ”€â”€ Persistence.swift                     // NSPersistentContainer ê´€ë¦¬
â”‚    â””â”€â”€ SUSA24_iOS.xcdatamodeld               // LocationEntity, CaseEntity, SuspectEntity
â”œâ”€â”€ ğŸ“ Presentation/
â”‚    â””â”€â”€ ğŸ—‚ï¸ MainTabScene/
â”‚         â”œâ”€â”€ MainTabFeature.swift             // SSOT: startLocationObserver, locationsUpdated
â”‚         â””â”€â”€ MainTabView.swift                // .onChange(of: locations) â†’ í•˜ìœ„ Feature ë™ê¸°í™”
â””â”€â”€ ğŸ“ Util/
     â”œâ”€â”€ ğŸ—‚ï¸ AppIntent/
     â”‚    â”œâ”€â”€ ReceiveMessageIntent.swift        // App Intent ì§„ì…ì  - perform() ë¹„ë™ê¸° ì²˜ë¦¬
     â”‚    â””â”€â”€ MessageParser.swift               // SMS í…ìŠ¤íŠ¸ íŒŒì‹± - extractAddress(), containsInvalidKeywords()
     â””â”€â”€ ğŸ—‚ï¸ Network/
          â””â”€â”€ ğŸ—‚ï¸ Service/
               â””â”€â”€ NaverGeocodeAPIService.swift // ì£¼ì†Œ â†’ ì¢Œí‘œ ë³€í™˜ (Naver Maps Geocoding API)
```

---

## 8. ì˜ˆì™¸ ìƒí™© ë° ëŒ€ì‘ ê¸°ì¤€

### ì˜ˆì™¸ ìƒí™© 1: ë¬¸ì íŒŒì‹± ì‹¤íŒ¨ â€” ì£¼ì†Œ ì¶”ì¶œ ë¶ˆê°€

- **ì¦ìƒ**: App Intent ì‹¤í–‰ í›„ ì•Œë¦¼ì´ ì˜¤ì§€ ì•ŠìŒ, íƒ€ì„ë¼ì¸ì— ìƒˆ ìœ„ì¹˜ ë¯¸í‘œì‹œ
- **ì›ì¸**: ë¬¸ì í˜•ì‹ì— `[ë°œì‹ ê¸°ì§€êµ­]` í…ìŠ¤íŠ¸ ë¯¸í¬í•¨, "í™•ì¸ë¶ˆê°€"/"ì „ì›êº¼ì§" ë“± ë¬´íš¨ í‚¤ì›Œë“œ í¬í•¨, í•œê¸€ ì£¼ì†Œ ë¶€ì¬
- **ëŒ€ì‘**: ``MessageParser``ì˜ `containsInvalidKeywords()` ë©”ì„œë“œì—ì„œ ë¬´íš¨ ë¬¸ìë¥¼ í•„í„°ë§í•˜ê³ , íŒŒì‹± ì‹¤íŒ¨ ì‹œ `nil`ì„ ë°˜í™˜í•˜ì—¬ Intentê°€ ì¡°ê¸° ì¢…ë£Œë©ë‹ˆë‹¤.

```swift
// MessageParser.swift
guard !containsInvalidKeywords(from: text) else {
    return nil  // ë¬´íš¨ ë¬¸ì â†’ ì €ì¥í•˜ì§€ ì•ŠìŒ
}
```

### ì˜ˆì™¸ ìƒí™© 2: ì§€ì˜¤ì½”ë”© API ì‹¤íŒ¨

- **ì¦ìƒ**: ì£¼ì†ŒëŠ” ì¶”ì¶œë˜ì—ˆìœ¼ë‚˜ ì¢Œí‘œê°€ ë³€í™˜ë˜ì§€ ì•Šì•„ ì €ì¥ ì‹¤íŒ¨
- **ì›ì¸**: Naver API í• ë‹¹ëŸ‰ ì´ˆê³¼, ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜, ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì£¼ì†Œ (ì‹ ê·œ ê°œë°œ ì§€ì—­ ë“±)
- **ëŒ€ì‘**: ``NaverGeocodeAPIService``ì—ì„œ `throws` ì²˜ë¦¬í•˜ê³ , ``ReceiveMessageIntent``ì—ì„œ `do-catch`ë¡œ ì—ëŸ¬ ì‹œ ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼ ë‹¤ì´ì–¼ë¡œê·¸ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.

```swift
// ReceiveMessageIntent.swift
do {
    let geocodeResult = try await NaverGeocodeAPIService.shared.geocode(address: address)
} catch {
    return .result(dialog: "ìœ„ì¹˜ ë³€í™˜ ì‹¤íŒ¨: \(error.localizedDescription)")
}
```

### ì˜ˆì™¸ ìƒí™© 3: ì „í™”ë²ˆí˜¸ë¡œ ì‚¬ê±´ ì¡°íšŒ ì‹¤íŒ¨

- **ì¦ìƒ**: ë¬¸ìëŠ” ìˆ˜ì‹ ë˜ë‚˜ "í•´ë‹¹ ì‚¬ê±´ ì—†ìŒ" ì•Œë¦¼ í‘œì‹œ
- **ì›ì¸**: ì‚¬ê±´ì— ë“±ë¡ëœ ì „í™”ë²ˆí˜¸ì™€ ë¬¸ì ë°œì‹ ë²ˆí˜¸ ë¶ˆì¼ì¹˜, ì „í™”ë²ˆí˜¸ ì •ê·œí™” ë¯¸ìŠ¤ë§¤ì¹˜
- **ëŒ€ì‘**: ì „í™”ë²ˆí˜¸ ì •ê·œí™” ë¡œì§(í•˜ì´í”ˆ/ê³µë°±/+82 ì œê±°) ì ìš©. ì‚¬ê±´ ë“±ë¡ ì‹œ ì „í™”ë²ˆí˜¸ í¬ë§· í†µì¼ì„ ê¶Œì¥í•©ë‹ˆë‹¤.

```swift
// ReceiveMessageIntent.swift - ì „í™”ë²ˆí˜¸ ì •ê·œí™”
let normalized = senderPhoneNumber
    .replacingOccurrences(of: "-", with: "")
    .replacingOccurrences(of: " ", with: "")
    .replacingOccurrences(of: "+82", with: "0")
```

### ì˜ˆì™¸ ìƒí™© 4: CoreData Observer ì¤‘ë³µ êµ¬ë…

- **ì¦ìƒ**: ê°™ì€ ìœ„ì¹˜ê°€ íƒ€ì„ë¼ì¸ì— ì—¬ëŸ¬ ë²ˆ í‘œì‹œ, ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§
- **ì›ì¸**: íƒ­ ì „í™˜ ì‹œ `watchLocations()`ê°€ ì¤‘ë³µ í˜¸ì¶œ
- **ëŒ€ì‘**: SSOT íŒ¨í„´ ì ìš©ìœ¼ë¡œ ``MainTabFeature``ì—ì„œë§Œ Observerë¥¼ ë‹¨ì¼ ê´€ë¦¬í•©ë‹ˆë‹¤. `stopLocationObserver` ì•¡ì…˜ìœ¼ë¡œ ëª…ì‹œì  í•´ì œ ë¡œì§ êµ¬í˜„ì´ í•„ìš”í•©ë‹ˆë‹¤.

---

## 9. ê¸°ëŠ¥ í•œê³„ ë° ì£¼ì˜ì‚¬í•­

- **Observer ì·¨ì†Œ(Cancel) ë¯¸êµ¬í˜„**: í˜„ì¬ `.stopLocationObserver` ì•¡ì…˜ì€ ì •ì˜ë˜ì–´ ìˆìœ¼ë‚˜ ì‹¤ì œ AsyncStream ì·¨ì†Œ ë¡œì§ì´ ì—†ìŠµë‹ˆë‹¤. ì•±ì´ ë°±ê·¸ë¼ìš´ë“œë¡œ ì „í™˜ë˜ê±°ë‚˜ í™”ë©´ì„ ë‚˜ê°€ë„ Observerê°€ ê³„ì† ì‹¤í–‰ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```swift
// í˜„ì¬ êµ¬í˜„ â€” ì‹¤ì œ cancel ë¡œì§ ì—†ìŒ
case .stopLocationObserver:
    return .none
```

- **ê´‘ë²”ìœ„í•œ CoreData ë³€ê²½ ê°ì§€**: `NSManagedObjectContextObjectsDidChange`ëŠ” ëª¨ë“  ì—”í‹°í‹° ë³€ê²½ì„ ê°ì§€í•©ë‹ˆë‹¤. Locationê³¼ ë¬´ê´€í•œ Case/Suspect ë³€ê²½ì—ë„ ë¶ˆí•„ìš”í•œ fetchê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- **ì˜¤í”„ë¼ì¸ ì €ì¥ ë¶ˆê°€**: ì§€ì˜¤ì½”ë”©ì´ ë„¤íŠ¸ì›Œí¬ í•„ìˆ˜ì´ë¯€ë¡œ ì˜¤í”„ë¼ì¸ ìƒíƒœì—ì„œ ìˆ˜ì‹ ëœ ë¬¸ìëŠ” ì²˜ë¦¬ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

- **ë¬¸ì í˜•ì‹ ì˜ì¡´ì„±**: í†µì‹ ì‚¬ë³„ ë¬¸ì í¬ë§·ì´ ë‹¤ë¥¼ ê²½ìš° ``MessageParser``ê°€ ì£¼ì†Œ ì¶”ì¶œì— ì‹¤íŒ¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í˜„ì¬ëŠ” `[ë°œì‹ ê¸°ì§€êµ­]` í…ìŠ¤íŠ¸ì— ì˜ì¡´í•©ë‹ˆë‹¤.

- **ì‚¬ê±´ë‹¹ ì—¬ëŸ¬ í”¼ì˜ì êµ¬ë¶„ ë¶ˆê°€**: í•œ ì‚¬ê±´ì— ì—¬ëŸ¬ ëª…ì˜ í”¼ì˜ìê°€ ì¡´ì¬í•  ìˆ˜ ìˆìœ¼ë‚˜, í˜„ì¬ëŠ” í•œ ì‚¬ê±´ì— í•œ ìš©ì˜ìë¡œ ì €ì¥í•©ë‹ˆë‹¤. KT ë“± í†µì‹ ì‚¬ëŠ” ê¸°ì§€êµ­ ìœ„ì¹˜ ë°œì‹  ë²ˆí˜¸ë¥¼ í•˜ë‚˜ë§Œ ë°œí–‰í•˜ë¯€ë¡œ, ë™ì¼ ì‚¬ê±´ ë‚´ ì—¬ëŸ¬ í”¼ì˜ìë¥¼ êµ¬ë¶„í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

> Warning:
> ê°™ì€ í†µì‹ ì‚¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ë³µìˆ˜ í”¼ì˜ìì˜ ê¸°ì§€êµ­ ë²ˆí˜¸ê°€ ë™ì¼í•  ìˆ˜ ìˆì–´, í”¼ì˜ìë³„ ìœ„ì¹˜ êµ¬ë¶„ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.
> ì˜ˆ: A ì‚¬ê±´ì˜ 'ê¹€', 'ìœ ', 'ë°•' í”¼ì˜ìê°€ ëª¨ë‘ KT ì‚¬ìš© ì‹œ â†’ ê¸°ì§€êµ­ ë°œì‹  ë²ˆí˜¸ê°€ ë™ì¼í•˜ì—¬ ìœ„ì¹˜ ë°ì´í„°ê°€ í˜¼ì¬ë©ë‹ˆë‹¤.

---

## 10. í–¥í›„ ê°œì„  ì‚¬í•­

### ê¸°ëŠ¥ ê³ ë„í™”

- **ì˜¤í”„ë¼ì¸ íì‰**: ë„¤íŠ¸ì›Œí¬ ë¯¸ì—°ê²° ì‹œ ë¬¸ìë¥¼ ë¡œì»¬ íì— ì €ì¥ í›„ ì—°ê²° ë³µêµ¬ ì‹œ ì¼ê´„ ì²˜ë¦¬
- **ë‹¤ì¤‘ í†µì‹ ì‚¬ íŒŒì„œ**: KT, SKT, LGU+ ë“± í†µì‹ ì‚¬ë³„ ë¬¸ì í¬ë§· ëŒ€ì‘ì„ ìœ„í•œ Parser Strategy íŒ¨í„´ ë„ì…
- **ì´ìƒ íŒ¨í„´ ê°ì§€**: ê¸‰ê²©í•œ ìœ„ì¹˜ ë³€í™” ë˜ëŠ” ì¥ì‹œê°„ ë™ì¼ ìœ„ì¹˜ ì²´ë¥˜ ì‹œ ìˆ˜ì‚¬ê´€ì—ê²Œ ì•Œë¦¼
- **ì‹¤ì‹œê°„ í‘¸ì‹œ ì•Œë¦¼**: ìƒˆ ìœ„ì¹˜ ì €ì¥ ì‹œ ì•± ë‚´ Toastê°€ ì•„ë‹Œ ì‹œìŠ¤í…œ Push Notification ë°œì†¡

### ê¸°ìˆ  ë¶€ì±„

- **Observer ì·¨ì†Œ ë¡œì§ êµ¬í˜„**: `observerTask?.cancel()`ì„ í†µí•œ ëª…ì‹œì  AsyncStream ì¢…ë£Œ ì²˜ë¦¬ í•„ìš”

```swift
// ê°œì„  ë°©í–¥
case .stopLocationObserver:
    observerTask?.cancel()
    return .none
```

- **ë³€ê²½ í•„í„°ë§ êµ¬ì²´í™”**: `NSManagedObjectContextObjectsDidChange` ëŒ€ì‹  LocationEntity ë³€ê²½ë§Œ ê°ì§€í•˜ë„ë¡ íƒ€ì… ì²´í¬ ë¡œì§ ì¶”ê°€ í•„ìš”

```swift
// ê°œì„  ë°©í–¥: notification.userInfoì—ì„œ íƒ€ì… ì²´í¬
guard let inserted = notification.userInfo?[NSInsertedObjectsKey] as? Set<NSManagedObject>,
      inserted.contains(where: { $0 is LocationEntity }) else { return }
```

- **Diff ê¸°ë°˜ ì—…ë°ì´íŠ¸**: `updateData` ì‹œ ì „ì²´ êµì²´ê°€ ì•„ë‹Œ ë³€ê²½ë¶„ë§Œ ë°˜ì˜í•˜ì—¬ ë Œë”ë§ ìµœì í™”
- **í…ŒìŠ¤íŠ¸ ì½”ë“œ ë³´ê°•**: ``MessageParser``, ``LocationRepository``ì˜ `watchLocations()` ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì¶”ê°€

---

## 11. ë‹´ë‹¹ ë° ì°¸ê³  ì •ë³´

| í•­ëª© | ë‚´ìš© |
| --- | --- |
| ë‹´ë‹¹ì | ìœ ê²½ëª¨ (iOS Developer) |
| ê´€ë ¨ PR | [SSOT ê¸°ë°˜ í† ëŒ€ êµ¬ì¶•](https://github.com/DeveloperAcademy-POSTECH/2025-C6-M6-DreamWorms/pull/50) |
| ê´€ë ¨ PR | [ì‹¤ì‹œê°„ Observer ì¶”ê°€](https://github.com/DeveloperAcademy-POSTECH/2025-C6-M6-DreamWorms/pull/122) |
| í•µì‹¬ íŒŒì¼ | ReceiveMessageIntent.swift, MessageParser.swift, MainTabFeature.swift, LocationRepository.swift |

---

## Topics

### Core Components

App Intent ìë™ ìˆ˜ì§‘ íŒŒì´í”„ë¼ì¸ì˜ í•µì‹¬ ì»´í¬ë„ŒíŠ¸ì…ë‹ˆë‹¤.

- ``ReceiveMessageIntent``
- ``MessageParser``
- ``MainTabFeature``

### Data Layer

ìœ„ì¹˜ ë°ì´í„°ì˜ ì €ì¥ê³¼ ì‹¤ì‹œê°„ ê´€ì¸¡ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤.

- ``LocationRepository``
- ``CaseRepository``
- ``NaverGeocodeAPIService``

### SSOT Pattern

ë‹¨ì¼ ì§„ì‹¤ ê³µê¸‰ì› íŒ¨í„´ìœ¼ë¡œ ë°ì´í„° ì¼ê´€ì„±ì„ ë³´ì¥í•©ë‹ˆë‹¤.

- ``MainTabView``
- ``MapDispatcher``

### Domain Models

íŒŒì´í”„ë¼ì¸ì—ì„œ ì‚¬ìš©ë˜ëŠ” ë°ì´í„° ëª¨ë¸ì…ë‹ˆë‹¤.

- ``Location``
- ``Case``
- ``LocationGroupedByDate``
